<%- include('partials/header') %>
<%- include('partials/navbar') %>

<!-- Load Tailwind only if not already present (safe if header already includes it) -->
<script>
  if (typeof window !== 'undefined' && typeof window.tailwind === 'undefined') {
    var s = document.createElement('script');
    s.src = "https://cdn.tailwindcss.com";
    document.head.appendChild(s);
  }
</script>

<main class="container mx-auto px-4 py-8 max-w-4xl">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-extrabold">My Quizzes</h1>
    <a href="/create-quiz" class="inline-block px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">
      âž• Create New
    </a>
  </div>

  <% if (typeof quizzes === 'undefined' || !Array.isArray(quizzes) || quizzes.length === 0) { %>
    <div class="bg-white p-6 rounded-2xl shadow-sm text-center">
      <p class="text-lg mb-4">You haven't created any quizzes yet.</p>
      <a href="/quizzes/new" class="inline-block px-4 py-2 rounded-lg bg-primary text-white hover:opacity-95">
        Create Your First Quiz
      </a>
    </div>
  <% } else { %>
    <div class="space-y-4">
      <% quizzes.forEach(function(quiz) { %>
        <div class="bg-white p-5 rounded-2xl shadow-sm flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <h2 class="text-lg font-semibold"><%= quiz.title %></h2>
            <p class="text-sm text-gray-600"><%= (quiz.questions && quiz.questions.length) ? quiz.questions.length : 0 %> Questions</p>
            <p class="text-sm text-gray-500 mt-1">Created: <%= new Date(quiz.createdAt).toLocaleDateString() %></p>
          </div>

          <div class="flex items-center gap-3">
            <div class="text-sm text-gray-600 break-all">
              <div class="font-medium text-xs text-gray-400">Quiz ID:</div>
              <div class="text-xs"><%= quiz._id %></div>
            </div>

            <!-- action links (kept textual functionality only) -->
            <a href="/quizzes/<%= quiz._id %>" class="inline-block px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200">View</a>
            <a href="/quizzes/<%= quiz._id %>/edit" class="inline-block px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200">Edit</a>
            <button type="button" class="delete-btn inline-block px-3 py-2 rounded-lg bg-red-100 text-red-700 hover:bg-red-200" data-quiz-id="<%= quiz._id %>" data-quiz-title="<%= quiz.title %>">Delete</button>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>
</main>

<!-- Delete Confirmation Modal -->
<div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg p-6 max-w-md w-full mx-4">
    <h2 class="text-xl font-bold mb-2">Delete Quiz?</h2>
    <p class="text-gray-700 mb-1">Are you sure you want to delete:</p>
    <p id="modal-quiz-title" class="text-lg font-semibold text-red-600 mb-4"></p>
    <p class="text-sm text-gray-600 mb-6">This action will also delete all student results for this quiz. This cannot be undone.</p>
    
    <div class="flex gap-3 justify-end">
      <button id="modal-cancel-btn" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">Cancel</button>
      <button id="modal-confirm-btn" class="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700">Delete</button>
    </div>
  </div>
</div>

<%- include('partials/footer') %>

<script>
  (function() {
    const modal = document.getElementById('delete-modal');
    const modalTitle = document.getElementById('modal-quiz-title');
    const cancelBtn = document.getElementById('modal-cancel-btn');
    const confirmBtn = document.getElementById('modal-confirm-btn');
    const deleteButtons = document.querySelectorAll('.delete-btn');

    let currentQuizId = null;

    // Show modal when delete button clicked
    deleteButtons.forEach(function(btn) {
      btn.addEventListener('click', function() {
        currentQuizId = btn.getAttribute('data-quiz-id');
        const quizTitle = btn.getAttribute('data-quiz-title');
        modalTitle.textContent = quizTitle;
        modal.classList.remove('hidden');
      });
    });

    // Hide modal on cancel
    cancelBtn.addEventListener('click', function() {
      modal.classList.add('hidden');
      currentQuizId = null;
    });

    // Close modal on background click
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        modal.classList.add('hidden');
        currentQuizId = null;
      }
    });

    // Submit deletion
    confirmBtn.addEventListener('click', function() {
      if (currentQuizId) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/quizzes/' + currentQuizId + '/delete';
        document.body.appendChild(form);
        form.submit();
      }
    });
  })();
</script>

<%- include('partials/footer') %>
