<%- include('partials/header') %>
<%- include('partials/navbar') %>

<!-- Load Tailwind only if not already present (safe if header already includes it) -->
<script>
  if (typeof window !== 'undefined' && typeof window.tailwind === 'undefined') {
    var s = document.createElement('script');
    s.src = "https://cdn.tailwindcss.com";
    document.head.appendChild(s);
  }
</script>

<main class="container mx-auto px-4 py-8">
  <h1 class="text-2xl font-extrabold mb-6">Quiz Results</h1>

  <% if (typeof results === 'undefined' || !Array.isArray(results) || results.length === 0) { %>
    <div class="bg-white p-6 rounded-2xl shadow-sm text-center">
      <p class="text-lg">No attempts yet on your quizzes.</p>
    </div>
  <% } else { %>
    <div class="overflow-x-auto bg-white rounded-2xl shadow-sm">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Candidate</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quiz</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Percentage</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
          </tr>
        </thead>

        <tbody class="bg-white divide-y divide-gray-100">
          <% results.forEach(function(result) { %>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900"><%= result.username %></div>
                <div class="text-xs text-gray-500 break-all"><%= result.userId %></div>
              </td>

              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700"><%= result.quizTitle %></td>

              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                <%= typeof result.score !== 'undefined' ? result.score : '' %>/<%= typeof result.totalQuestions !== 'undefined' ? result.totalQuestions : '' %>
              </td>

              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                <% if (typeof result.percentage !== 'undefined' && result.percentage !== null && !isNaN(result.percentage)) { %>
                  <%= result.percentage.toFixed(1) %>%
                <% } else { %>
                  N/A
                <% } %>
              </td>

              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= result.attemptedAt ? new Date(result.attemptedAt).toLocaleDateString() : '' %>
              </td>

              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= result.attemptedAt ? new Date(result.attemptedAt).toLocaleTimeString() : '' %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } %>
</main>

<%- include('partials/footer') %>